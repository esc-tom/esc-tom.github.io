<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dialogue Annotation Tool</title>
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>
    <!-- Login Modal -->
    <div id="login-modal" class="modal login-modal show">
        <div class="modal-content login-modal-content">
            <div class="modal-header">
                <h3>üë§ Login to ESC-ToM Annotation Tool</h3>
            </div>
            <div class="modal-body">
                <p class="login-instruction">Welcome back! Enter your credentials to continue annotating.</p>
                
                <!-- Username Input -->
                <div class="form-group">
                    <label for="login-username-input">Username:</label>
                    <input type="text" id="login-username-input" class="login-input" placeholder="Enter your username" maxlength="20" autocomplete="username">
                </div>
                
                <!-- Password Input -->
                <div class="form-group">
                    <label for="login-password-input">Password:</label>
                    <input type="password" id="login-password-input" class="login-input" placeholder="Enter your password" autocomplete="current-password">
                </div>
                
                <!-- Existing Users -->
                <div class="existing-users">
                    <p class="section-label">Or select an existing user:</p>
                    <div id="user-list" class="user-list">
                        <p class="loading-users">Loading users...</p>
                    </div>
                </div>
                
                <div id="login-error" class="login-error hidden"></div>
            </div>
            <div class="modal-footer">
                <button id="login-btn" class="btn btn-success btn-large">Login</button>
                <p class="modal-link">Don't have an account? <a href="#" id="show-register-link">Register here</a></p>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="modal login-modal">
        <div class="modal-content login-modal-content">
            <div class="modal-header">
                <h3>üìù Register for ESC-ToM Annotation Tool</h3>
            </div>
            <div class="modal-body">
                <p class="login-instruction">Create a new account. You'll be assigned 10 unique dialogues to annotate.</p>
                
                <!-- Username Input -->
                <div class="form-group">
                    <label for="register-username-input">Username:</label>
                    <div class="input-with-status">
                        <input type="text" id="register-username-input" class="login-input" placeholder="Choose a username (3-20 characters)" maxlength="20" autocomplete="username">
                        <span id="register-username-status" class="username-status"></span>
                    </div>
                    <p class="help-text">Only letters, numbers, underscore, and hyphen allowed</p>
                    <p id="register-username-availability" class="username-availability"></p>
                </div>
                
                <!-- Password Input -->
                <div class="form-group">
                    <label for="register-password-input">Password:</label>
                    <input type="password" id="register-password-input" class="login-input" placeholder="Choose a password (min 6 characters)" autocomplete="new-password">
                    <p class="help-text">Choose a secure password to protect your annotations</p>
                </div>
                
                <!-- Confirm Password -->
                <div class="form-group">
                    <label for="register-confirm-password-input">Confirm Password:</label>
                    <input type="password" id="register-confirm-password-input" class="login-input" placeholder="Re-enter your password" autocomplete="new-password">
                </div>
                
                <div id="register-error" class="login-error hidden"></div>
            </div>
            <div class="modal-footer">
                <button id="register-btn" class="btn btn-primary btn-large">Register New User</button>
                <p class="modal-link">Already have an account? <a href="#" id="show-login-link">Login here</a></p>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="header-title-row">
                <h1>ESC-ToM Annotation Tool</h1>
                <div class="user-badge" id="user-badge"></div>
            </div>
            <div class="header-controls">
                <div class="dialogue-selector">
                    <label for="dialogue-select">Select Dialogue:</label>
                    <select id="dialogue-select">
                        <option value="">-- Select --</option>
                    </select>
                </div>
                <div class="progress-section">
                    <div class="progress-info">
                        <span id="progress-text">Loading...</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar">
                            <span class="progress-bar-text" id="progress-bar-text">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- Left Panel: Dialogue Display -->
            <div class="dialogue-panel">
                <div class="dialogue-header">
                    <h2>Dialogue History</h2>
                    <div id="current-dialogue-info" class="dialogue-info"></div>
                </div>
                
                <!-- Dialogue Progress Bar -->
                <div class="dialogue-progress-section">
                    <div class="dialogue-progress-info">
                        <span id="dialogue-progress-text">No dialogue loaded</span>
                    </div>
                    <div class="dialogue-progress-bar-container">
                        <div class="dialogue-progress-bar" id="dialogue-progress-bar">
                            <span class="dialogue-progress-bar-text" id="dialogue-progress-bar-text">0%</span>
                        </div>
                    </div>
                </div>
                
                <!-- Persona Information -->
                <div id="persona-section" class="persona-section" style="display: none;">
                    <div class="persona-header">
                        <h3>üë§ Patient Profile</h3>
                    </div>
                    <div class="persona-content">
                        <div class="persona-row">
                            <span class="persona-label">Name:</span>
                            <span id="persona-name" class="persona-value"></span>
                        </div>
                        <div class="persona-row">
                            <span class="persona-label">Gender:</span>
                            <span id="persona-gender" class="persona-value"></span>
                        </div>
                        <div class="persona-row">
                            <span class="persona-label">Education:</span>
                            <span id="persona-education" class="persona-value"></span>
                        </div>
                        <div class="persona-row">
                            <span class="persona-label">Occupation:</span>
                            <span id="persona-occupation" class="persona-value"></span>
                        </div>
                        <div class="persona-row full-width">
                            <span class="persona-label">Personality (Big Five):</span>
                            <div id="persona-big-five" class="persona-big-five"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Situation and Thought Context -->
                <div id="context-section" class="context-section" style="display: none;">
                    <div class="context-box">
                        <h4>Situation:</h4>
                        <p id="context-situation" class="context-text"></p>
                    </div>
                    <div class="context-box">
                        <h4>Patient's Thought:</h4>
                        <p id="context-thought" class="context-text"></p>
                    </div>
                </div>
                
                <div id="dialogue-container" class="dialogue-container">
                    <p class="placeholder">Loading first dialogue...</p>
                </div>
                <div class="dialogue-info-box">
                    <p class="info-text">
                        <strong>Instructions:</strong> 
                        1. Review the dialogue. <strong>Click "Edit" on any utterance to modify weird/unclear content.</strong><br>
                        2. <strong>Click on the turn</strong> that provided the minimum necessary context for your annotation.<br>
                        3. <strong>Revise the ground truth</strong> BDI and cognitive appraisals on the right (pre-filled for you).<br>
                        4. Save when done.
                    </p>
                </div>
            </div>

            <!-- Right Panel: Annotation Form -->
            <div class="annotation-panel">
                <h2>Revise Ground Truth Annotations</h2>
                <p class="annotation-subtitle">Review and modify the pre-filled annotations below</p>
                
                <div id="annotation-locked-message" class="annotation-locked-message">
                    <span class="lock-icon">üîí</span>
                    <span class="lock-text">Click "Ready to Annotate" to enable annotation fields</span>
                </div>
                
                <!-- BDI Section -->
                <div class="annotation-section collapsible">
                    <h3 class="section-header" data-section="bdi">
                        <span class="collapse-icon">‚ñº</span>
                        BDI (Belief, Desire, Intention)
                    </h3>
                    <div class="section-content" id="bdi-content">
                        <div class="form-group">
                            <label for="belief">Belief:</label>
                            <div class="bdi-input-wrapper">
                                <span class="bdi-prefix">I believe that</span>
                                <input type="text" id="belief" placeholder="ground truth will load here..."></input>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="desire">Desire:</label>
                            <div class="bdi-input-wrapper">
                                <span class="bdi-prefix">I wish to</span>
                                <input type="text" id="desire" placeholder="ground truth will load here..."></input>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="intention">Intention:</label>
                            <div class="bdi-input-wrapper">
                                <span class="bdi-prefix">I intend to</span>
                                <input type="text" id="intention" placeholder="ground truth will load here..."></input>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cognitive Appraisals Section -->
                <div class="annotation-section collapsible">
                    <h3 class="section-header" data-section="appraisals">
                        <span class="collapse-icon">‚ñº</span>
                        Cognitive Appraisals
                    </h3>
                    <div class="section-content" id="appraisals-content">
                        <p class="help-text">Ground truth appraisals are pre-selected. Modify selections as needed. Drag to reorder by importance.</p>
                        
                        <div class="appraisal-selector">
                            <label>Available Dimensions (click to select):</label>
                            <div id="appraisal-options" class="appraisal-options"></div>
                        </div>

                        <div class="appraisal-ranking">
                            <label>Selected Appraisals (Drag to Reorder):</label>
                            <div id="selected-appraisals" class="selected-appraisals">
                                <p class="placeholder-small">Click on dimensions above to add them here</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button id="save-btn" class="btn btn-success" disabled>Save Annotation</button>
                    <button id="clear-btn" class="btn btn-warning">Clear Annotations</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Pop-up -->
    <div id="notification-popup" class="notification-popup">
        <div class="notification-content">
            <span class="notification-icon" id="notification-icon"></span>
            <span class="notification-message" id="notification-message"></span>
            <button class="notification-close" id="notification-close">‚úï</button>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üíæ Confirm Save</h3>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to save this annotation?</p>
                <div class="annotation-summary">
                    <div class="summary-item">
                        <span class="summary-label">Dialogue:</span>
                        <span id="confirm-dialogue-id" class="summary-value"></span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Turns viewed:</span>
                        <span id="confirm-turns" class="summary-value"></span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Appraisals selected:</span>
                        <span id="confirm-appraisals" class="summary-value"></span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Ready to annotate:</span>
                        <span id="confirm-ready-turn" class="summary-value"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirm-cancel" class="btn btn-secondary">Cancel</button>
                <button id="confirm-save" class="btn btn-success">Yes, Save</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <!-- Firebase storage client -->
    <script src="scripts/firebase-storage.js"></script>

    <script src="scripts/script.js"></script>
</body>
</html>

